<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
                        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.demo.first.mapper.BoardMapper">

	<!-- 글 추가하기 -->
	<insert id="insert" parameterType="map">
		INSERT INTO board(
				name,
				password,
				subject,
				content,
				create_date
			) VALUES (
				#{name},
				#{password},
				#{subject},
				#{content},
				now()			
			)
	</insert>
	
	<!-- 글 상세보기 -->
	<select id="detail" resultType="BoardVO">
		SELECT
			idx,
			name,
			password,
			subject,
			content,
			view_cnt AS viewCnt,
			date_format(create_date,  '%y-%m-%d %H:%i:%s') AS createDate,
			date_format(update_date,  '%y-%m-%d %H:%i:%s') AS updateDate
		FROM
			board
		WHERE
			idx = #{idx}
	</select>
	
	<!-- 글 목록보기 -->
	<select id="selectList" resultType="BoardVO" parameterType="int">
		SELECT
			idx,
			name,
			subject,
			date_format(create_date,  '%y-%m-%d %H:%i:%s') AS createDate,
			date_format(update_date,  '%y-%m-%d %H:%i:%s') AS updateDate,
			view_cnt AS viewCnt
		FROM
			board
		ORDER BY 
			update_date DESC
		LIMIT
			#{startNo},#{pageSize}
	</select>
	
	<!-- 글 건수 -->
	<select id="selectCount" resultType="int">
		SELECT
			 count(*) 
		FROM
			board 
	</select>
	
	<!-- 글 수정하기 -->
	<update id="update" parameterType="map">
		UPDATE board SET
			subject = #{subject},
			content = #{content},
			update_date = now()
		WHERE
			idx = #{idx}
	</update>
	
	<!-- 글 삭제하기 -->
	<delete id="delete" parameterType="int">
		DELETE FROM board 
			WHERE
				idx = #{idx}
	</delete>
	
	<!-- 조회수 카운트하기 -->
	<update id="viewCnt" parameterType="int">
		UPDATE board SET
			view_cnt = view_cnt + 1
		WHERE
			idx = #{idx}
	</update>
</mapper>